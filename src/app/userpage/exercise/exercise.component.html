<div class="cards-container">
  @for (item of cards; track item) {
  <div class="card" [class.selected]="item === selectedCard" (click)="selectCard(item, $event)"
    [style.background-image]="'url(' + item.backgroundImage + ')'">
    <div class="card-title">{{ item.title }}</div>
    <div class="card-description">
      <p>{{ item.description }}</p>
      <p>{{ item.note }}</p>
    </div>
  </div>
  }
</div>

<!-- <div class="main"> -->
<section class="content">
  <!-- 運動類型選擇區 -->
  <div class="carousel">
    <!-- 顯示被選擇的類型對應的圖片 -->
    @for (category of imageList; track category.type) {
    @if (category.type === activeType) {
    <div>
      <h3>{{ category.type }} 類運動</h3>
      <div style="display: flex; gap: 10px;">
        @for (item of category.data; track item.name) {
        <div style="text-align: center; cursor: pointer;" [class.selected]="selectedImageName === item.name"
          (click)="selectImage(item)">
          <img [src]="item.src" alt="{{ item.name }}" width="300px" height="300px" />
          <p>{{ item.name }}</p>
        </div>
        }
      </div>
    </div>
    }
    }
  </div>

  <div class="bottom-section">
    <div class="clock-container">
      <div class="clock-face">
        <div class="clock-highlight" #highlightDiv></div>
        <!-- 時鐘數字 -->
        <div class="clock-numbers">
          @for (number of numbers; track number.value) {
          <div class="number" [style.transform]="'rotate(' + number.angle + 'deg) translate(0, -130px)'">
            {{ number.value }}
          </div>
          }
        </div>
        <!-- highlight 遮罩 -->
        <div class="clock-highlight" #highlightDiv></div>

        <!-- 時鐘指針 -->
        <div class="hand hour-hand" [ngStyle]="{'transform': 'rotate(' + hourDeg + 'deg)'}"></div>
        <div class="hand minute-hand" [ngStyle]="{'transform': 'rotate(' + minuteDeg + 'deg)'}"></div>
        <div class="hand second-hand" [ngStyle]="{'transform': 'rotate(' + secondDeg + 'deg)'}"></div>

        <!-- 時鐘中心點 -->
        <div class="clock-center"></div>
      </div>
    </div>

    <div class="info">
      <div class="info-item">
        <!-- <input type="text" [(ngModel)]="exercise_name" placeholder="輸入運動名稱"> -->

        <div style="font-size: px;">
          選到的圖片名稱
          <p style="font-weight: bold;">{{ selectedImageName || '請選擇運動項目' }}</p>
        </div>

        選擇運動多久
        <input type="number" [(ngModel)]="minutesInput" (ngModelChange)="onMinutesChange($event)"
          (change)="setStartMinutes()" placeholder="輸入分鐘數">
        <button>設定時間</button>

        @if (isTimeSet) {
        <div class="time-display">
          <p>運動將於 {{ endTime }} 結束</p>
          <p>持續時間：{{ duration }} 分鐘</p>
        </div>
        }

        請選擇日期
        <input type="date" [min]="minDate" [max]="maxDate" [(ngModel)]="date">
        <p-datepicker [(ngModel)]="date" name="exerciseDate" dateFormat="yy.mm.dd" />
      </div>
      <button class="btn" (click)="confirm()">確認</button>
    </div>
  </div>
</section>

<div class="daily-tasks">
  <h2>每日任務</h2>

  <!-- 上層：七張卡片區 -->
  <div class="task-cards-container">
    @for (day of getLastSevenDays(); track day.toISOString()) {
    <div class="task-items">
      @for (record of getRecordsForDate(day); track record.exerciseId) {
      <div class="task-item">
        <div class="task-type">{{ record.sports_name || '運動' }}</div>
        <div class="task-name">{{ record.exerciseName }}</div>
        <div class="task-duration">{{ record.duration }} 分鐘</div>
      </div>
      }
    </div>
    }
  </div>

  <!-- 下層：等級系統區 -->
  <div class="xp-panel-container">
    <!-- 運動記錄區 -->
    <div class="task-cards-container">
      @for (day of lastSevenDaysWithRecords; track day.date.toISOString()) {
      <div class="task-card">
        <div class="task-date">{{ day.date | date:'MM/dd' }}</div>

        <div class="task-items">
          @for (record of day.records; track record.exerciseId) {
          <div class="task-item">
            <div [class.completed]="record.completed">
              <div> {{ record.exerciseName }} </div>
              <div> {{ record.duration }} 分鐘 </div>
              <button class="task-btn" (click)="completeExercise(record)">
                {{ record.completed ? '✓' : '完成' }}
              </button>
            </div>
          </div>
          }
        </div>
      </div>
      }
    </div>

    <!-- 經驗值顯示區 -->
    <!-- <div class="xp-panel">
      <h3>等級系統</h3>
      <div>等級: {{ xpSystem.currentLevel }}</div>
      <div>經驗值: {{ xpSystem.totalXp }}/{{ xpSystem.expToNextLevel }}</div>
      <progress [value]="xpSystem.totalXp" [max]="xpSystem.expToNextLevel"></progress>

      <div class="progress-bars">
        <div>
          <span>每日進度: {{ xpSystem.dailyProgress | number:'1.0-0' }}%</span>
          <progress [value]="xpSystem.dailyProgress" max="100"></progress>
        </div>
        <div>
          <span>每週進度: {{ xpSystem.weeklyProgress | number:'1.0-0' }}%</span>
          <progress [value]="xpSystem.weeklyProgress" max="100"></progress>
        </div>
      </div>
    </div>
  </div> -->
</div>
